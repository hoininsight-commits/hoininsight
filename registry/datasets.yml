# NOTE: This file is additive. New fields must be backward-compatible.

version: "v1.3"
policy:
  additive_only: true
  dedupe:
    enabled: true
    rule: "fingerprint(entity+ts+unit+source+metric_name)"
  derived_metrics:
    mark_is_derived: true
    require_derived_from: true

datasets:
  - dataset_id: "crypto_btc_usd_spot_coingecko"
    enabled: true
    soft_fail: false
    entity: "BTCUSD"
    unit: "USD"
    source: "coingecko"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.coingecko_btc:write_raw_quote"
    normalizer: "src.normalizers.btc_curated:write_curated_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "BTCUSD"
    curated_path: "data/curated/crypto/btc_usd.csv"

  - dataset_id: "fx_usdkrw_spot_open_er_api"
    enabled: true
    soft_fail: false
    entity: "USDKRW"
    unit: "KRW"
    source: "open.er-api.com"
    metric_name: "spot_rate"
    schema_version: "timeseries_v1"
    collector: "src.collectors.exchangerate_usdkrw:write_raw_usdkrw"
    normalizer: "src.normalizers.usdkrw_curated:write_curated_usdkrw_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "USDKRW"
    curated_path: "data/curated/fx/usdkrw.csv"

  - dataset_id: "metal_gold_xauusd_spot_gold_api"
    enabled: true
    soft_fail: true
    entity: "XAUUSD"
    unit: "USD"
    source: "gold-api.com"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.goldapi_xau:write_raw_xau_usd"
    normalizer: "src.normalizers.xau_curated:write_curated_xau_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "XAUUSD"
    curated_path: "data/curated/metals/gold_usd.csv"

  - dataset_id: "metal_silver_xagusd_spot_gold_api"
    enabled: true
    soft_fail: true
    entity: "XAGUSD"
    unit: "USD"
    source: "gold-api.com"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.goldapi_xag:write_raw_xag_usd"
    normalizer: "src.normalizers.xag_curated:write_curated_xag_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "XAGUSD"
    curated_path: "data/curated/metals/silver_usd.csv"

  - dataset_id: "rates_us10y_yield_ustreasury"
    enabled: true
    soft_fail: true
    entity: "US10Y"
    unit: "PCT"
    source: "treasury.gov"
    metric_name: "yield"
    schema_version: "timeseries_v1"
    collector: "src.collectors.ustreasury_yield_curve:write_raw_us10y"
    normalizer: "src.normalizers.us10y_curated:write_curated_us10y_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "US10Y"
    curated_path: "data/curated/rates/us10y.csv"

  - dataset_id: "risk_vix_index_stooq"
    enabled: true
    soft_fail: true
    entity: "VIX"
    unit: "INDEX"
    source: "stooq.com"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.stooq_vix:write_raw_vix"
    normalizer: "src.normalizers.vix_curated:write_curated_vix_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "VIX"
    curated_path: "data/curated/risk/vix.csv"

  - dataset_id: "index_spx_sp500_stooq"
    enabled: true
    soft_fail: true
    entity: "SPX"
    unit: "INDEX"
    source: "stooq.com"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.stooq_spx:write_raw_spx"
    normalizer: "src.normalizers.spx_curated:write_curated_spx_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "SPX"
    curated_path: "data/curated/indices/spx.csv"

  - dataset_id: "index_kospi_stooq"
    enabled: true
    soft_fail: true
    entity: "KOSPI"
    unit: "INDEX"
    source: "stooq.com"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.stooq_kospi:write_raw_kospi"
    normalizer: "src.normalizers.kospi_curated:write_curated_kospi_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "KOSPI"
    curated_path: "data/curated/indices/kospi.csv"

  - dataset_id: "derived_corr_btc_spx_30d"
    enabled: true
    soft_fail: true
    entity: "BTC_SPX_CORR30D"
    unit: "CORR"
    source: "derived"
    metric_name: "rolling_corr_30d"
    schema_version: "timeseries_v1"
    collector: "src.collectors.derived_corr_btc_spx:write_raw_corr_btc_spx_30d"
    normalizer: "src.normalizers.derived_corr_btc_spx_curated:write_curated_corr_btc_spx_30d"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "BTCxSPX_CORR30D"
    curated_path: "data/curated/derived/corr_btc_spx_30d.csv"

  - dataset_id: "derived_corr_usdkrw_us10y_30d"
    enabled: true
    soft_fail: true
    entity: "USDKRW_US10Y_CORR30D"
    unit: "CORR"
    source: "derived"
    metric_name: "rolling_corr_30d"
    schema_version: "timeseries_v1"
    collector: "src.collectors.derived_corr_usdkrw_us10y:write_raw_corr_usdkrw_us10y_30d"
    normalizer: "src.normalizers.derived_corr_usdkrw_us10y_curated:write_curated_corr_usdkrw_us10y_30d"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "USDKRWxUS10Y_CORR30D"
    curated_path: "data/curated/derived/corr_usdkrw_us10y_30d.csv"

  - dataset_id: "index_nasdaq_ndx_stooq"
    category: "GLOBAL_INDEX"
    enabled: true
    soft_fail: true
    entity: "NDX"
    unit: "INDEX"
    source: "stooq"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.market_collectors:write_raw_nasdaq"
    normalizer: "src.normalizers.market_normalizers:normalize_nasdaq"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "NASDAQ"
    curated_path: "data/curated/indices/nasdaq.csv"

  - dataset_id: "fx_dxy_index_stooq"
    category: "FX_RATES"
    enabled: true
    soft_fail: true
    entity: "DXY"
    unit: "INDEX"
    source: "stooq"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.market_collectors:write_raw_dxy"
    normalizer: "src.normalizers.market_normalizers:normalize_dxy"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "DXY"
    curated_path: "data/curated/fx/dxy.csv"

  - dataset_id: "rates_us02y_yield_ustreasury"
    category: "RATES_YIELD"
    enabled: true
    soft_fail: true
    entity: "US02Y"
    unit: "PCT"
    source: "treasury.gov"
    metric_name: "yield"
    schema_version: "timeseries_v1"
    collector: "src.collectors.market_collectors:write_raw_us02y"
    normalizer: "src.normalizers.market_normalizers:normalize_us02y"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "US02Y"
    curated_path: "data/curated/rates/us02y.csv"

  - dataset_id: "comm_wti_crude_oil_stooq"
    category: "COMMODITIES"
    enabled: true
    soft_fail: true
    entity: "WTI"
    unit: "USD"
    source: "stooq"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.market_collectors:write_raw_wti"
    normalizer: "src.normalizers.market_normalizers:normalize_wti"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "WTI"
    curated_path: "data/curated/commodities/wti.csv"

  - dataset_id: "metal_platinum_xptusd_stooq"
    category: "PRECIOUS_METALS"
    enabled: true
    soft_fail: true
    entity: "XPTUSD"
    unit: "USD"
    source: "stooq"
    metric_name: "close"
    schema_version: "timeseries_v1"
    collector: "src.collectors.market_collectors:write_raw_platinum"
    normalizer: "src.normalizers.market_normalizers:normalize_platinum"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "PLATINUM"
    curated_path: "data/curated/metals/platinum.csv"

  - dataset_id: "crypto_eth_usd_spot_coingecko"
    category: "CRYPTO"
    enabled: true
    soft_fail: true
    entity: "ETHUSD"
    unit: "USD"
    source: "coingecko"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.market_collectors:write_raw_eth"
    normalizer: "src.normalizers.market_normalizers:normalize_eth"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "ETHUSD"
    curated_path: "data/curated/crypto/eth_usd.csv"

