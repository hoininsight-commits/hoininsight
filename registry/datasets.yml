version: "v1.3"
policy:
  additive_only: true
  dedupe:
    enabled: true
    rule: "fingerprint(entity+ts+unit+source+metric_name)"
  derived_metrics:
    mark_is_derived: true
    require_derived_from: true

datasets:
  - dataset_id: "crypto_btc_usd_spot_coingecko"
    enabled: true
    entity: "BTCUSD"
    unit: "USD"
    source: "coingecko"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.coingecko_btc:write_raw_quote"
    normalizer: "src.normalizers.btc_curated:write_curated_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "BTCUSD"
    curated_path: "data/curated/crypto/btc_usd.csv"

  - dataset_id: "fx_usdkrw_spot_open_er_api"
    enabled: true
    entity: "USDKRW"
    unit: "KRW"
    source: "open.er-api.com"
    metric_name: "spot_rate"
    schema_version: "timeseries_v1"
    collector: "src.collectors.exchangerate_usdkrw:write_raw_usdkrw"
    normalizer: "src.normalizers.usdkrw_curated:write_curated_usdkrw_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "USDKRW"
    curated_path: "data/curated/fx/usdkrw.csv"

  - dataset_id: "metal_gold_xauusd_spot_gold_api"
    enabled: true
    entity: "XAUUSD"
    unit: "USD"
    source: "gold-api.com"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.goldapi_xau:write_raw_xau_usd"
    normalizer: "src.normalizers.xau_curated:write_curated_xau_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "XAUUSD"
    curated_path: "data/curated/metals/gold_usd.csv"

  - dataset_id: "metal_silver_xagusd_spot_gold_api"
    enabled: true
    entity: "XAGUSD"
    unit: "USD"
    source: "gold-api.com"
    metric_name: "spot_price"
    schema_version: "timeseries_v1"
    collector: "src.collectors.goldapi_xag:write_raw_xag_usd"
    normalizer: "src.normalizers.xag_curated:write_curated_xag_csv"
    anomaly: "src.anomaly_detectors.roc_1d:detect_roc_1d"
    topic: "src.topic_selectors.simple_topic:select_topics"
    report_key: "XAGUSD"
    curated_path: "data/curated/metals/silver_usd.csv"
