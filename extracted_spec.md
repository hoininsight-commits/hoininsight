# ✅ HOIN ENGINE vNext — Economic Hunter Compatibility (Final Spec for Antigravity)\
\
## 0) 최상위 목표 (고정)\
HOIN ENGINE의 최종 모습은 3단 구조다.\
\
1) **Event Detection (Daily, 1일)**  \
   - “오늘 뭐가 이상하게 튀었나?”를 감지한다.  \
   - **판단/확정/레벨/WHY_NOW 금지**  \
   - 결과물: **Anchor 후보(섹터/자산/현상) + Candidate Driver 후보**\
\
2) **Narrative Topic (Short-term State, 3~7일)**  \
   - “이게 사람들 입에 오를 ‘이야기’로 굳어질 조건인가?”를 관리한다.  \
   - **영상 주제(경제사냥꾼 스타일) 생성 가능**  \
   - 단, **Structural Topic 아님 / Level 부여 금지**\
\
3) **Structural Topic (기존 HOIN ENGINE, 증거 기반)**  \
   - 기존 STEP 1~6 (DATA AXIS → BASELINE → ANOMALY → WHY_NOW → LEVEL → GAP)로만 확정한다.  \
   - 기존 엔진의 신뢰/재현/헌법을 절대 훼손하지 않는다.\
\
\u003e 핵심: **하루 데이터는 “판단”이 아니라 “이상 감지”에만 사용**한다.  \
\u003e 경제사냥꾼은 “하루 이벤트”로 말문을 열고, 결론은 누적 맥락에서 만든다. 우리도 동일하게 레이어를 분리한다.\
\
---\
\
## 1) 우리가 오늘 합의한 핵심 개념 (반드시 구현)\
### 1-1) “섹터는 사용자가 주는 게 아니라 엔진이 먼저 찾는다”\
- 경제사냥꾼이 바이오를 선택한 건 사용자가 줘서가 아니라  \
  **시장 대비 섹터 괴리(상대강도), 섹터 내부 붕괴(브레드스), 대장 충격(리더쇼크), 스타일 로테이션(돈 성격 변화)** 같은 신호로  \
  “바이오가 이상하다”를 먼저 감지했기 때문이다.\
\
### 1-2) Topic Anchor vs Narrative Driver (필수 분리)\
- **Topic Anchor**: 사람들이 체감하는 관측 지점 (예: “바이오 섹터 하락”)  \
- **Narrative Driver**: 그 현상을 만든 구조적 힘 (예: “자본의 평가 기준이 가능성→숫자로 이동”)\
\
\u003e 고정 문장:  \
\u003e **“토픽은 사람들이 느끼는 곳에서 잡고, 설명은 자본이 움직이는 이유에서 한다.”**\
\
---\
\
## 2) 무분별한 확장 금지 원칙 (개발 가드레일)\
- 신규 데이터는 **최소 3~5개 신호만** 추가한다.\
- 신규 로직은 **추가 레이어(Event/Narrative)에서만 동작**하며,\
- 기존 3대 문서(헌법/데이터마스터/이상징후 로직)는 **핵심 구조를 유지**한다.\
- Narrative Topic에는 **Level(L2~L4) 부여 금지**, WHY_NOW 확정 금지, 투자 추천 금지.\
\
---\
\
# 3) ZIP(정의 문서) 기준 파일 변경/추가 설계\
\
\u003e 사용자 지시: “이제 정의파일 수정 불가 규칙은 폐지. 단, 무분별한 변경은 금지. 필요한 것만 수정/추가.”\
\
## 3-1) 수정(EDIT)해야 하는 파일 (최소)\
### (A) 최상위 헌법/가이드 문서 1곳에 “레이어 구조”를 추가\
- 파일명이 ZIP에서 무엇이든 상관없다.  \
  단, **‘엔진의 최상위 정의/헌법/부트로더’ 역할 문서** 1개를 찾아 거기에 섹션을 추가한다.\
\
#### 추가할 섹션 제목 예시\
`## ENGINE LAYERS (Event → Narrative → Structural)`\
\
#### 추가할 내용(필수 문장)\
- Daily data is used for **Event detection only**.\
- Events do not imply State.\
- State requires multi-day confirmation (3~7 days).\
- Structural judgment is only allowed via existing STEP 1~6.\
- Narrative Topic is not Structural Topic and must not assign LEVEL.\
\
\u003e ⚠️ 기존 문장 삭제/교체 금지. **섹션 추가만**.\
\
---\
\
## 3-2) 추가(ADD)해야 하는 파일/폴더 (핵심)\
ZIP 내부에 아래 디렉토리를 새로 추가한다. (이름은 동일 권장)\
\
```text\
SIGNAL_DETECTION_LAYER/\
  ├─ SECTOR_DIVERGENCE_FINDER_v1.0.md\
  ├─ TEMPORAL_INTERPRETATION_RULES_v1.0.md\
  └─ SECTOR_ANCHOR_SCHEMA_v1.0.yml (또는 .md)\
\
NARRATIVE_LAYER/\
  ├─ NARRATIVE_TOPIC_DEFINITION_v1.1.md\
  ├─ TOPIC_ANCHOR_AND_DRIVER_v1.0.md\
  ├─ NARRATIVE_TOPIC_SCHEMA_v1.0.yml (또는 .md)\
  └─ CASE_STUDIES/\
      ├─ case_palantir_hdhyundai_v1.0.md\
      └─ case_bio_sector_drawdown_v1.0.md\
\
INTEGRATION_RULES/\
  └─ NARRATIVE_TO_STRUCTURAL_GATE_v1.0.md\
```\
\
---\
\
# 4) 각 파일에 들어가야 하는 “정확한 내용”\
\
## 4-1) `SIGNAL_DETECTION_LAYER/SECTOR_DIVERGENCE_FINDER_v1.0.md`\
### 목적\
- 사용자가 섹터를 주지 않아도  \
  **엔진이 “이상하게 혼자 움직인 섹터/테마”를 자동으로 잡는다.**\
- 결과는 **Topic Anchor 후보**로 출력된다 (확정 주제 아님).\
\
### 최소 감지 신호 (딱 5개, 더 늘리지 말 것)\
1) **Sector Relative Strength Divergence**  \
   - 시장(지수) 대비 섹터 수익률 괴리 Top-K (예: Top 3)\
2) **Breadth Collapse (섹터 내부 폭)**  \
   - 섹터 내 상승/하락 종목 비율 (top N 구성 종목만으로도 가능)\
3) **Leader Shock Flag (대장 충격)**  \
   - 섹터 대장 1~3개 갭/거래량 급증/급락 여부\
4) **Expectation Reset Proxy (호재에도 하락)**  \
   - “좋은 뉴스인데 빠졌다” (이벤트 텍스트 + 반응 수익률)\
5) **Capital Style Rotation Proxy (돈 성격 변화 프록시)**  \
   - 실적 섹터 vs 성장 섹터 상대강도(프록시 1~2개만)\
\
### 출력(고정)\
- `SECTOR_ANCHOR_CANDIDATE` 형태로 출력:\
  - benchmark_return\
  - sector_return\
  - relative_gap\
  - breadth\
  - leader_shock\
  - trigger_event_candidate\
  - narrative_driver_candidates (여러 개 가능)\
  - confidence(LOW/MEDIUM/HIGH) — “정확도”가 아니라 “이상 감지 강도”\
\
---\
\
## 4-2) `SIGNAL_DETECTION_LAYER/TEMPORAL_INTERPRETATION_RULES_v1.0.md`\
### 목적\
- “하루 데이터만 보고 판단하면 위험” 문제를 원천 봉쇄한다.\
\
### 반드시 들어갈 규칙(고정)\
- **Event (1일)**: 감지만 가능. 판단/확정/레벨 금지.  \
- **State (3~7일)**: 반복/지속/동시성으로 후보 강화.  \
- **Structural (기존 엔진)**: STEP 1~6 통과 시만 확정 가능.\
\
---\
\
## 4-3) `NARRATIVE_LAYER/NARRATIVE_TOPIC_DEFINITION_v1.1.md`\
\u003e (우리가 만든 v1.0에 “Anchor/Driver” 섹션을 추가해 v1.1로 올리는 것을 권장)\
\
### 목적\
- 경제사냥꾼 스타일 “영상 주제”를 공식 엔진 산출물로 만든다.\
- 단, Structural Topic을 대체하지 않는다.\
\
### 생성 조건(필수 3요소, 더 늘리지 말 것)\
- Intent Signal (2개 이상)\
- Structural Hint (1개 이상)\
- Era Fit (1개 이상)\
\
### 금지\
- Level 부여 금지\
- WHY_NOW 확정 금지\
- 투자 추천/종목 추천 금지\
\
### 반드시 포함할 섹션: Topic Anchor vs Narrative Driver\
- Narrative Topic은 항상 **둘 다를 출력**해야 한다:\
  - Topic Anchor(표면)\
  - Narrative Driver(심층)\
\
---\
\
## 4-4) `NARRATIVE_LAYER/TOPIC_ANCHOR_AND_DRIVER_v1.0.md`\
### 목적\
- 엔진이 “진짜 원인(Driver) = 토픽”이라고 착각하는 문제 방지.\
\
### 고정 문장 포함(필수)\
- “토픽은 사람들이 느끼는 곳에서 잡고, 설명은 자본이 움직이는 이유에서 한다.”\
\
---\
\
## 4-5) `NARRATIVE_LAYER/NARRATIVE_TOPIC_SCHEMA_v1.0.yml`\
### 목적\
- 출력 포맷을 고정해서, 영상 스크립트 자동화까지 이어지게 함.\
\
권장 스키마:\
```yaml\
NARRATIVE_TOPIC:\
  topic_anchor:\
  narrative_driver:\
  trigger_event:\
  core_narrative:\
  intent_signals:\
  structural_hint:\
  era_fit:\
  confidence_level: [LOW, MEDIUM, HIGH]\
  risk_note:\
  disclaimer:\
```\
\
---\
\
## 4-6) `INTEGRATION_RULES/NARRATIVE_TO_STRUCTURAL_GATE_v1.0.md`\
### 목적\
- Narrative Topic이 Structural Topic을 오염시키지 않게 차단.\
\
### 필수 규칙\
- Narrative Topic은 **자동 승격 금지**\
- Structural Topic은 **오직 기존 STEP 1~6로만**\
- Narrative Topic에서 Level/WHY_NOW 사용 금지\
\
---\
\
## 4-7) 케이스 스터디(필수 2개)\
### `case_palantir_hdhyundai_v1.0.md`\
- Anchor: HD현대(또는 조선/산업AI)\
- Driver: “AI가 제조 생산성 숫자로 증명 단계 진입”\
- Intent Signal: 30% 단축, 2030, 전사적 계약\
- Structural Hint: 조선→전력→로봇 확장\
- Era Fit: AI 말장난 피로, 생산성 증명 갈증\
\
### `case_bio_sector_drawdown_v1.0.md`\
- Anchor: 바이오 섹터 하락\
- Driver: “자본 평가 기준이 가능성→숫자(실적/로열티)로 이동”\
- Intent Signal: 로열티 2% vs 3~7%, 투자 비중 수치\
- Structural Hint: 섹터 재평가, 대장 이벤트→섹터 심리\
- Era Fit: 고지수/유동성 환경에서 실적 섹터 선호\
\
---\
\
# 5) 개발(코드) 구현 지시 — “어떤 모듈이 무엇을 해야 하는가”\
\
## 5-1) 파이프라인 레이어 추가 (논리 흐름)\
기존(추정):  \
`data → anomaly → topics → report`\
\
변경(최종):\
1) **Event Detection (SDF)** 실행  \
   - 입력: daily snapshot(지수/섹터/대장/브레드스/뉴스 이벤트 텍스트 최소)\
   - 출력: `sector_anchor_candidates.json`\
\
2) **Narrative Topic Builder (NTB)** 실행  \
   - 입력: `sector_anchor_candidates` + 최근 3~7일 누적(최소)\
   - 출력: `narrative_topics.json`\
\
3) **Structural Topic (기존 엔진)** 실행  \
   - 기존 STEP 1~6 그대로\
   - 출력: 기존 topics.json\
\
4) 리포트/대시보드 출력에서\
   - “Structural Topics” 섹션\
   - “Narrative Topics (Unconfirmed)” 섹션을 분리 표기\
\
## 5-2) “하루 데이터만으로 결론 내리기” 방지 코드 가드\
- `Event layer` 결과는 항상 `candidate`로만 저장\
- `Narrative`는 “영상/해설용” 라벨과 disclaimer 필수\
- `Structural`만 기존 엔진 출력(레벨/WHY_NOW 허용)\
\
---\
\
# 6) 데이터 추가는 “최소”만 (무분별 수집 금지 충족)\
필요 데이터(최소)만 명시한다:\
\
- 벤치마크 지수 수익률 (KOSPI/KOSDAQ/SPX 중 해당 시장)\
- 섹터 지수/섹터 ETF 수익률 (가능한 범위에서)\
- 섹터 대표(대장) 1~3개 가격/거래량\
- 섹터 breadth(상승/하락 비율) — 구성 종목 Top N만\
- 이벤트 텍스트(공시/계약/임상/실적) — “존재 여부” 수준으로 최소\
\
\u003e 추가 데이터가 더 필요하다고 판단되면, 반드시  \
\u003e **‘재현 실패 → 필수성 입증 → 사전 제안 → 승인 → 추가’** 절차를 따른다.\
\
---\
\
# 7) 최종 검증 시나리오 (Antigravity가 반드시 통과해야 함)\
\
## 테스트 1) “바이오를 사용자 입력 없이” 탐지\
- 입력: “KOSPI는 강한데 바이오만 약한” 데이터(또는 과거 데이터)\
- 기대: SDF가 바이오를 `Sector Anchor Candidate`로 뽑아야 함\
\
## 테스트 2) Narrative Topic 생성\
- 기대: Narrative Topic에\
  - Topic Anchor(바이오)\
  - Narrative Driver(평가 기준 변화)\
  - Intent Signal(로열티/투자비중 수치)\
  - Risk Note/Disclaimer\
  가 반드시 포함\
\
## 테스트 3) Structural Topic 오염 방지\
- Narrative Topic이 있어도\
  - Structural Topic이 없을 수 있음(정상)\
  - Level/WHY_NOW가 Narrative에 붙으면 실패\
\
---\
\
# 8) 엔진이 도달해야 하는 “최종 출력 상태” (요구사항)\
- 오늘처럼 “Structural Topic 없음”이어도,\
  - **Narrative Topic은 존재**할 수 있다.\
- 엔진은 더 이상 “주제 없음”으로 침묵하지 않는다.\
  - 대신 이렇게 말해야 한다:\
\
\u003e **“Structural Topic은 없지만,  \
\u003e Narrative Topic(미확정 영상 주제 후보)은 있다.”**\
\
---\
\
## ✅ Antigravity 실행 지시(요약)\
- [EDIT] 최상위 헌법/부트로더 문서에 “3-Layer 구조 + 시간 해석 규칙” 섹션 추가\
- [ADD] `SIGNAL_DETECTION_LAYER/` 전부 추가\
- [ADD] `NARRATIVE_LAYER/` 전부 추가 (특히 Anchor/Driver)\
- [ADD] `INTEGRATION_RULES/` 게이트 규칙 추가\
- [CODE] 파이프라인에 SDF → NTB 레이어를 추가하고, 출력/리포트에서 Structural과 분리 표시\
\
---\
\
원하면 내가 다음으로 **안티그래피티에게 바로 붙여넣는 “개발 프롬프트 1개”** 형태로 더 날카롭게(명령형) 재작성해줄 수도 있어.  \
하지만 위 문서만으로도 충분히 개발 가능한 수준으로 “구조/파일/내용/가드레일”을 전부 명시했다.",{"_232":2230,"_364":2236,"_230":2237,"_234":235,"_238":2049,"_128":2165,"_236":237,"_240":239,"_241":2207,"_131":2166,"_67":24},[2231],{"_358":1095,"_360":2232,"_362":2232,"_364":2233,"_366":2234,"_368":59,"_370":-5,"_27":1099,"_1100":2235,"_1104":14},7820,[],[],[],[],[],[],"moderation_results",[],"current_node","conversation_id","is_archived",[988,990,995,994,992,997,985,2245,998,2246,996,999,986,2247,993,989,2248,987,991],"https://www.youtube.com/watch?v=ZtF_xLiYyU4","https://www.openai.com","https://www.youtube.com/watch?v=xB9IRV-JcQU","https://www.youtube.com/watch?v=_noPya798wg","blocked_urls",[],"disabled_tool_ids",[],"memory_scope","global_enabled","sugar_item_visible","is_study_mode","is_public","linear_conversation",[2260,2262,2270,2278,2287,2302,2309,2327,2340,2348,2356,2368,2381,2389,2397,2431,2444,2452,2460,2478,2491,2499,2507,2525,2540,2548,2556,2564,2572,2580,2592,2607,2615,2623,2631,2639,2647,2654,2662,2670,2682,2695,2703,2711,2729,2742,2750,2758,2780,2793,2801,2809,2825,2833,2841,2979,2994,3002,3010,3028,3041,3049,3057,3075,3088,3096,3104,3122,3135,3143,3151,3167,3180,3188,3196,3214,3227,3235,3243,3261,3274,3282,3290,3308,3321,3329,3337,3355,3368,3376,3384,3402,3415,3423,3431,3449,3462,3470,3478,3496,3509,3517,3525,3543,3556,3564,3572,3587,3600,3608,3616,3624,3642,3655,3663,3671,3681,3688],{"_40":38,"_41":2261},[43],{"_40":43,"_45":2263,"_70":38,"_41":2269},{"_40":43,"_47":2264,"_53":2266,"_60":61,"_62":12,"_63":64,"_51":2268,"_68":69},{"_49":50,"_51":2265},{},{"_55":56,"_57":2267},[59],{"_66":12,"_67":24},[72],{"_40":72,"_45":2271,"_70":43,"_41":2277},{"_40":72,"_47":2272,"_53":2274,"_60":61,"_62":12,"_63":64,"_51":2276,"_68":69},{"_49":50,"_51":2273},{},{"_55":56,"_57":2275},[59],{"_80":12,"_67":24,"_66":12},[82],{"_40":82,"_45":2279,"_70":72,"_41":2286},{"_40":82,"_47":2280,"_32":87,"_53":2282,"_60":61,"_63":90,"_51":2284,"_68":69},{"_49":50,"_51":2281},{},{"_55":56,"_57":2283},[59],{"_92":2285,"_67":24,"_66":12},[],[95],{"_40":95,"_45":2288,"_70":82,"_41":2301},{"_40":95,"_47":2289,"_32":101,"_53":2291,"_60":61,"_63":90,"_51":2293,"_68":69},{"_49":99,"_51":2290},{},{"_55":56,"_57":2292},[104],{"_92":2294,"_118":2296,"_120":2297,"_122":2298,"_124":2299,"_128":129,"_130":-5,"_131":132,"_67":24},[2295],{"_40":108,"_109":110,"_111":112,"_113":114,"_115":116,"_117":14},[],[],[],{"_126":2300},[],[134],{"_40":134,"_45":2303,"_70":95,"_41":2308},{"_40":134,"_47":2304,"_32":140,"_53":2306,"_60":61,"_63":90,"_51":2307,"_68":69},{"_49":138,"_51":2305},{},{"_55":142,"_143":59},{"_67":24,"_145":12},[147],{"_40":147,"_45":2310,"_70":134,"_41":2326},{"_40":147,"_47":2311,"_32":152,"_53":2313,"_60":61,"_62":12,"_63":90,"_51":2315,"_68":69,"_242":243},{"_49":138,"_51":2312},{},{"_55":56,"_57":2314},[155],{"_157":2316,"_163":12,"_164":2318,"_230":2324,"_232":2325,"_234":235,"_128":129,"_236":237,"_238":239,"_240":239,"_241":134,"_131":132,"_67":24},{"_27":159,"_160":2317},[162],{"_166":-5,"_167":-5,"_168":-5,"_169":-5,"_170":-5,"_171":-5,"_172":64,"_173":174,"_175":176,"_177":2319,"_182":183,"_184":2320,"_225":-5,"_226":227,"_228":2323},[179,180,181],{"_186":187,"_188":189,"_182":183,"_190":191,"_192":14,"_193":64,"_194":64,"_195":196,"_197":14,"_198":12,"_199":12,"_200":201,"_202":203,"_204":14,"_205":206,"_207":14,"_208":209,"_210":211,"_212":213,"_172":64,"_173":174,"_175":176,"_214":215,"_216":-5,"_217":218,"_177":2321,"_220":-5,"_221":2322,"_224":90},[179,180,181],[223],[],[],[],[245],{"_40":245,"_45":2328,"_70":147,"_41":2339},{"_40":245,"_47":2329,"_32":250,"_53":2331,"_60":61,"_63":90,"_51":2333,"_68":69},{"_49":99,"_51":2330},{},{"_55":56,"_57":2332},[253],{"_118":2334,"_120":2335,"_122":2336,"_124":2337,"_128":260,"_130":-5,"_131":261,"_67":24},[],[],[],{"_126":2338},[],[263],{"_40":263,"_45":2341,"_70":245,"_41":2347},{"_40":263,"_47":2342,"_32":268,"_53":2344,"_60":61,"_62":12,"_63":64,"_51":2346,"_68":69},{"_49":50,"_51":2343},{},{"_55":56,"_57":2345},[59],{"_272":12,"_128":260,"_236":237,"_238":239,"_240":239,"_241":245,"_131":261,"_66":12,"_67":24},[274],{"_40":274,"_45":2349,"_70":263,"_41":2355},{"_40":274,"_47":2350,"_32":279,"_53":2352,"_60":61,"_62":12,"_63":64,"_51":2354,"_68":69},{"_49":50,"_51":2351},{},{"_55":56,"_57":2353},[59],{"_80":12,"_128":260,"_236":237,"_238":239,"_240":239,"_241":263,"_131":261,"_67":24,"_66":12},[284],{"_40":284,"_45":2357,"_70":274,"_41":2367},{"_40":284,"_47":2358,"_32":289,"_53":2360,"_60":61,"_62":12,"_63":90,"_51":2362,"_68":69,"_242":243},{"_49":138,"_51":2359},{},{"_55":56,"_57":2361},[292],{"_157":2363,"_163":12,"_230":2365,"_232":2366,"_234":235,"_128":260,"_236":237,"_238":239,"_240":239,"_241":274,"_131":261,"_67":24},{"_27":159,"_160":2364},[162],[],[],[299],{"_40":299,"_45":2369,"_70":284,"_41":2380},{"_40":299,"_47":2370,"_32":304,"_53":2372,"_60":61,"_63":90,"_51":2374,"_68":69},{"_49":99,"_51":2371},{},{"_55":56,"_57":2373},[307],{"_118":2375,"_120":2376,"_122":2377,"_124":2378,"_128":314,"_130":-5,"_131":315,"_67":24},[],[],[],{"_126":2379},[],[317],{"_40":317,"_45":2382,"_70":299,"_41":2388},{"_40":317,"_47":2383,"_32":322,"_53":2385,"_60":61,"_62":12,"_63":64,"_51":2387,"_68":69},{"_49":50,"_51":2384},{},{"_55":56,"_57":2386},[59],{"_272":12,"_128":314,"_236":237,"_238":239,"_240":239,"_241":299,"_131":315,"_66":12,"_67":24},[327],{"_40":327,"_45":2390,"_70":317,"_41":2396},{"_40":327,"_47":2391,"_32":332,"_53":2393,"_60":61,"_62":12,"_63":64,"_51":2395,"_68":69},{"_49":50,"_51":2392},{},{"_55":56,"_57":2394},[59],{"_80":12,"_128":314,"_236":237,"_238":239,"_240":239,"_241":317,"_131":315,"_67":24,"_66":12},[337],{"_40":337,"_45":2398,"_70":327,"_41":2430},{"_40":337,"_47":2399,"_32":342,"_53":2401,"_60":61,"_62":12,"_63":90,"_51":2403,"_68":69,"_242":243},{"_49":138,"_51":2400},{},{"_55":56,"_57":2402},[345],{"_157":2404,"_163":12,"_164":2