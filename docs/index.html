<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOIN Operator v2.1</title>
    <link rel="stylesheet" href="ui/styles.css?v=2.1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f172a',
                            card: '#1e293b',
                            text: '#f8fafc',
                            muted: '#94a3b8',
                            border: '#334155'
                        },
                        brand: {
                            primary: '#3b82f6',
                            secondary: '#64748b',
                            accent: '#f59e0b',
                            danger: '#ef4444',
                            success: '#22c55e'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Base Styles */
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            @apply bg-dark-bg text-dark-text min-h-screen flex overflow-hidden;
        }

        /* Sidebar */
        .sidebar {
            @apply w-64 bg-dark-card border-r border-dark-border flex flex-col p-6 z-10 shadow-lg;
            height: 100vh;
        }

        .logo {
            @apply text-xl font-bold text-white mb-8 flex items-center gap-2;
        }

        .menu-item {
            @apply px-4 py-3 mb-2 rounded-lg cursor-pointer transition-all duration-200 font-medium text-dark-muted flex items-center gap-3;
        }

        .menu-item:hover {
            @apply bg-slate-800 text-white;
        }

        .menu-item.active {
            @apply bg-blue-600/10 text-blue-400 font-semibold border-l-4 border-blue-500;
        }

        /* Main Content */
        .main-content {
            @apply flex-1 p-8 overflow-y-auto h-screen relative;
        }

        /* Loading Overlay */
        #loading-overlay {
            @apply fixed inset-0 bg-dark-bg/80 backdrop-blur-sm z-50 flex items-center justify-center;
            transition: opacity 0.3s;
        }

        .spinner {
            @apply w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin;
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Legacy Link */
        .legacy-link {
            @apply mt-auto pt-6 border-t border-dark-border text-xs text-dark-muted hover:text-white transition-colors flex items-center gap-2;
        }
    </style>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-overlay">
        <div class="text-center">
            <div class="spinner mb-4 mx-auto"></div>
            <div class="text-lg font-semibold text-blue-400">HOIN Operator Engine</div>
            <div class="text-sm text-dark-muted mt-2">v2.1 System Loading...</div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="logo">
            <span class="text-red-500">üî¥</span> HOIN Operator
        </div>

        <div class="flex flex-col gap-1">
            <div class="menu-item active" onclick="app.navigate('today')">
                <span>üìÖ</span> Ïò§Îäò ÏÑ†Ï†ï
            </div>
            <div class="menu-item" onclick="app.navigate('history')">
                <span>üóÇÔ∏è</span> ÏÑ†Ï†ï ÌûàÏä§ÌÜ†Î¶¨
            </div>
            <div class="menu-item" onclick="app.navigate('system')">
                <span>üõ°Ô∏è</span> ÏãúÏä§ÌÖú ÏÉÅÌÉú
            </div>
        </div>

        <a href="legacy/index.html" class="legacy-link" target="_blank">
            <span>External Link ‚Üó</span>
            <span>Legacy Dashboard</span>
        </a>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Views will be injected here -->
        <div id="view-container" class="max-w-7xl mx-auto space-y-6"></div>
    </main>

    <!-- Core Application Logic -->
    <script type="module">
        // View Router
        const views = {
            today: { js: './ui/operator_today.js?v=2.1', init: 'initTodayView' },
            history: { js: './ui/operator_history.js?v=2.1', init: 'initHistoryView' },
            system: { js: './ui/operator_system.js?v=2.1', init: 'initSystemView' }
        };

        // App Controller
        const app = {
            currentView: null,

            async init() {
                // Check URL params for initial view
                const params = new URLSearchParams(window.location.search);
                const initialView = params.get('view') || 'today';
                await this.navigate(initialView);

                // Remove loading overlay
                setTimeout(() => {
                    const loader = document.getElementById('loading-overlay');
                    if (loader) {
                        loader.style.opacity = '0';
                        setTimeout(() => loader.remove(), 300);
                    }
                }, 500);
            },

            async navigate(viewName) {
                if (!views[viewName]) return;

                // Update UI state
                document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
                const activeMenu = Array.from(document.querySelectorAll('.menu-item'))
                    .find(el => el.innerText.includes(this.getViewLabel(viewName)));
                if (activeMenu) activeMenu.classList.add('active');

                // Load View Module
                const container = document.getElementById('view-container');
                container.innerHTML = `<div class="animate-pulse flex space-x-4"><div class="flex-1 space-y-6 py-1"><div class="h-2 bg-slate-700 rounded"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="h-2 bg-slate-700 rounded col-span-2"></div><div class="h-2 bg-slate-700 rounded col-span-1"></div></div><div class="h-2 bg-slate-700 rounded"></div></div></div></div>`;

                try {
                    const viewConfig = views[viewName];
                    const module = await import(viewConfig.js);

                    // Clear container and init view
                    container.innerHTML = '';
                    if (module[viewConfig.init]) {
                        await module[viewConfig.init](container);
                    } else {
                        console.error(`Init function ${viewConfig.init} not found in ${viewConfig.js}`);
                        container.innerHTML = `<div class="text-red-500">Failed to load view logic.</div>`;
                    }

                    // Update URL without reload
                    const url = new URL(window.location);
                    url.searchParams.set('view', viewName);
                    window.history.pushState({}, '', url);

                } catch (e) {
                    console.error('Navigation Error:', e);
                    container.innerHTML = `<div class="p-4 bg-red-900/20 border border-red-500/50 rounded text-red-400">
                        Error loading view: ${e.message}
                    </div>`;
                }
            },

            getViewLabel(view) {
                const labels = { today: 'Ïò§Îäò ÏÑ†Ï†ï', history: 'ÏÑ†Ï†ï ÌûàÏä§ÌÜ†Î¶¨', system: 'ÏãúÏä§ÌÖú ÏÉÅÌÉú' };
                return labels[view] || '';
            }
        };

        // Global Access for Menu Clicks
        window.app = app;

        // Start App
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>

</html>